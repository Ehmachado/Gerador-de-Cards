<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Barreiras - Gerador de Cards</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&family=Montserrat:wght@300;400;600;700;900&family=Playfair+Display:wght@400;700;900&family=Bebas+Neue&family=Righteous&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.4);
            max-width: 1400px;
            width: 100%;
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-size: 3em;
            font-weight: 900;
            letter-spacing: -1px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: block;
            padding: 14px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .themes-section {
            margin-bottom: 30px;
        }

        .themes-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .themes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .theme-btn {
            padding: 20px;
            border: 4px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 700;
            color: white;
            text-align: center;
            font-size: 1em;
            position: relative;
            overflow: hidden;
        }

        .theme-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .theme-btn:hover::before {
            opacity: 1;
        }

        .theme-btn:hover {
            transform: scale(1.05);
        }

        .theme-btn.active {
            border-color: white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            transform: scale(1.08);
        }

        .preview-section {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        #cardCanvas {
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 100%;
            height: auto;
        }

        .export-btn {
            padding: 18px 40px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-family: 'Poppins', sans-serif;
        }

        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
        }

        .info {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-left: 5px solid #0ea5e9;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .info strong {
            color: #0c4a6e;
        }

        .tabela-section {
            margin-bottom: 30px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            border: 2px solid #e5e7eb;
        }

        .tabela-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .galeria-section {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: 20px;
            border: 3px solid #f59e0b;
        }

        .galeria-section h2 {
            text-align: center;
            color: #92400e;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .galeria-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .galeria-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .galeria-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        #galeriaCanvas {
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        .galeria-item {
            margin-bottom: 40px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .galeria-item h3 {
            text-align: center;
            color: #92400e;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .galeria-item canvas {
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto 15px auto;
        }

        .galeria-download-btn {
            display: block;
            margin: 0 auto;
            padding: 12px 30px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }

        .galeria-download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.5);
        }

        .pessoas-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .pessoa-card {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }

        .pessoa-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .pessoa-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1em;
            text-align: center;
        }

        .pessoa-inputs {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .preview-section {
            margin-bottom: 20px;
        }

        .preview-section h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card-preview-item {
            text-align: center;
            position: relative;
        }

        .card-preview-item canvas {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }

        .card-preview-item p {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
        }

        .card-download-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .card-download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .action-btn {
            font-family: 'Poppins', sans-serif;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .clear-btn:hover {
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5);
        }

        .refresh-btn:hover {
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
        }

        .galeria-item {
            margin-bottom: 50px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .galeria-item h3 {
            text-align: center;
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .galeria-item canvas {
            border-radius: 15px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto 20px auto;
        }

        .galeria-download-btn {
            display: block;
            margin: 0 auto;
            padding: 15px 40px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .galeria-download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ SUPER BARREIRAS üèÜ</h1>
        <p class="subtitle">Gerador de Cards - Desafios Completos</p>
        
        <div class="info">
            <strong>üí° Dica:</strong> Organize suas fotos com nomes como <code>001.jpg</code>, <code>002.png</code>, etc. O sistema buscar√° automaticamente a foto correspondente ao prefixo!
        </div>

        <div class="tabela-section">
            <h3 style="color: #667eea; margin-bottom: 15px;">üìä Importa√ß√£o R√°pida de Dados</h3>
            <div class="info" style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-left-color: #10b981;">
                <strong>‚ú® Cole sua tabela aqui!</strong> Formato: <code>Prefixo | Depend√™ncia | Nome do Gerente Geral</code> (separado por Tab ou v√≠rgula)
            </div>
            <textarea id="tabelaDados" placeholder="Exemplo:
001	Loja Centro	Jo√£o Silva Santos
002	Loja Norte	Maria Oliveira Costa
003	Loja Sul	Pedro Henrique Lima" style="width: 100%; min-height: 150px; padding: 15px; border: 2px solid #e5e7eb; border-radius: 12px; font-family: 'Courier New', monospace; font-size: 14px; margin-bottom: 15px;"></textarea>
            <button onclick="processarTabela()" style="padding: 12px 30px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 16px;">
                üì• IMPORTAR DADOS DA TABELA
            </button>
        </div>

        <div class="controls">
            <div class="input-group">
                <label>üé® S√≠mbolo Super Barreiras</label>
                <div class="file-input-wrapper">
                    <input type="file" id="simboloEmpresa" accept="image/*">
                    <label for="simboloEmpresa" class="file-input-label">üè¢ Upload do S√≠mbolo</label>
                </div>
            </div>

            <div class="input-group">
                <label>üéØ Nome do Desafio</label>
                <input type="text" id="nomeDesafio" placeholder="Ex: Desafio Inova√ß√£o 2024" value="Desafio Inova√ß√£o">
            </div>

            <div class="input-group">
                <label>üí¨ Mensagem de Parab√©ns</label>
                <textarea id="mensagemParabens" placeholder="Ex: Parab√©ns pelo incr√≠vel trabalho!">üéâ PARAB√âNS! üéâ</textarea>
            </div>

            <div class="input-group">
                <label>üìÅ Pasta de Fotos</label>
                <div class="file-input-wrapper">
                    <input type="file" id="pastaFotos" webkitdirectory directory multiple accept="image/*">
                    <label for="pastaFotos" class="file-input-label">üì∏ Selecionar Pasta</label>
                </div>
            </div>
        </div>

        <div class="info" style="background: linear-gradient(135deg, #fef3c7, #fde68a); border-left-color: #f59e0b;">
            <strong>üë• Adicione at√© 59 pessoas:</strong> Preencha os dados de cada pessoa abaixo. Somente os cards com nome preenchido ser√£o gerados!
        </div>

        <div style="display: flex; gap: 15px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap;">
            <button onclick="limparCampos()" class="action-btn clear-btn" style="padding: 12px 30px; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 16px; transition: all 0.3s;">
                üóëÔ∏è LIMPAR TODOS OS CAMPOS
            </button>
            <button onclick="atualizarPreviews()" class="action-btn refresh-btn" style="padding: 12px 30px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 16px; transition: all 0.3s;">
                üîÑ ATUALIZAR PREVIEWS
            </button>
        </div>

        <div class="pessoas-container" id="pessoasContainer"></div>

        <script>
        // Gerar os 59 campos de pessoas dinamicamente
        const pessoasContainer = document.getElementById('pessoasContainer');
        for (let i = 0; i < 59; i++) {
            const pessoaCard = document.createElement('div');
            pessoaCard.className = 'pessoa-card';
            pessoaCard.innerHTML = `
                <h3>üë§ Pessoa ${i + 1}</h3>
                <div class="pessoa-inputs">
                    <div class="input-group">
                        <label>Nome Completo</label>
                        <input type="text" class="pessoaNome" data-index="${i}" placeholder="Ex: Jo√£o Silva"${i === 0 ? ' value="Ana Costa"' : ''}>
                    </div>
                    <div class="input-group">
                        <label>Nome da Equipe</label>
                        <input type="text" class="pessoaEquipe" data-index="${i}" placeholder="Ex: Equipe Alpha"${i === 0 ? ' value="Equipe Vencedora"' : ''}>
                    </div>
                    <div class="input-group">
                        <label>Prefixo da Foto</label>
                        <input type="text" class="pessoaPrefixo" data-index="${i}" placeholder="Ex: ${String(i + 1).padStart(3, '0')}"${i === 0 ? ' value="001"' : ''}>
                    </div>
                </div>
            `;
            pessoasContainer.appendChild(pessoaCard);
        }
        </script>

        <div class="themes-section">
            <h2 class="themes-title">üé® Escolha o Tema Perfeito</h2>
            <div class="themes" id="themesContainer"></div>
        </div>

        <div class="preview-section">
            <h2>üì∏ Preview dos Cards</h2>
            <div class="cards-grid" id="cardsGrid"></div>
        </div>

        <button class="export-btn" onclick="exportAllCards()">üíæ GERAR E BAIXAR TODOS OS CARDS</button>

        <div class="galeria-section">
            <h2>üèÜ GALERIA DOS CAMPE√ïES üèÜ</h2>
            <div class="info" style="background: rgba(255,255,255,0.8); border-left-color: #f59e0b;">
                <strong>üé® Crie galerias especiais!</strong> As galerias s√£o agrupadas automaticamente de 10 em 10 cards. Escolha o layout e baixe cada galeria individualmente.
            </div>
            <div class="galeria-buttons">
                <button class="galeria-btn" onclick="gerarTodasGalerias(2)">üì± Galerias 2 Colunas</button>
                <button class="galeria-btn" onclick="gerarTodasGalerias(3)">üñºÔ∏è Galerias 3 Colunas</button>
                <button class="galeria-btn" onclick="gerarTodasGalerias(4)">üé¨ Galerias 4 Colunas</button>
                <button class="galeria-btn" onclick="gerarTodasGalerias(5)">üåü Galerias 5 Colunas</button>
            </div>
            <div id="galeriasContainer"></div>
        </div>
    </div>

    <script>
        const themes = [
            {
                name: 'üåÖ Sunset Dream',
                bgType: 'gradient',
                bgColors: ['#ff6b6b', '#ee5a6f', '#f093fb', '#f5576c'],
                patternType: 'waves',
                fontFamily: 'Poppins',
                primaryColor: '#ffffff',
                secondaryColor: '#ffe5e5',
                accentColor: '#ff4757',
                shadowColor: 'rgba(255, 71, 87, 0.4)'
            },
            {
                name: 'üåä Ocean Breeze',
                bgType: 'gradient',
                bgColors: ['#00d2ff', '#0984e3', '#00b4db', '#0083b0'],
                patternType: 'dots',
                fontFamily: 'Montserrat',
                primaryColor: '#ffffff',
                secondaryColor: '#e0f7ff',
                accentColor: '#0984e3',
                shadowColor: 'rgba(9, 132, 227, 0.4)'
            },
            {
                name: 'üå≤ Forest Magic',
                bgType: 'gradient',
                bgColors: ['#11998e', '#38ef7d', '#0ba360', '#3cba92'],
                patternType: 'hexagons',
                fontFamily: 'Poppins',
                primaryColor: '#ffffff',
                secondaryColor: '#e8f8f5',
                accentColor: '#00b894',
                shadowColor: 'rgba(0, 184, 148, 0.4)'
            },
            {
                name: 'üëë Royal Purple',
                bgType: 'gradient',
                bgColors: ['#a855f7', '#7c3aed', '#6366f1', '#8b5cf6'],
                patternType: 'stars',
                fontFamily: 'Playfair Display',
                primaryColor: '#ffffff',
                secondaryColor: '#f3e8ff',
                accentColor: '#9333ea',
                shadowColor: 'rgba(147, 51, 234, 0.4)'
            },
            {
                name: 'üî• Fire Energy',
                bgType: 'gradient',
                bgColors: ['#ff4757', '#ff6348', '#ff793f', '#ffb142'],
                patternType: 'circles',
                fontFamily: 'Bebas Neue',
                primaryColor: '#ffffff',
                secondaryColor: '#fff5f5',
                accentColor: '#ee5a6f',
                shadowColor: 'rgba(255, 71, 87, 0.4)'
            },
            {
                name: 'üçÉ Mint Fresh',
                bgType: 'gradient',
                bgColors: ['#06beb6', '#48b1bf', '#00f2c3', '#0098f0'],
                patternType: 'triangles',
                fontFamily: 'Montserrat',
                primaryColor: '#ffffff',
                secondaryColor: '#e6fffa',
                accentColor: '#00b894',
                shadowColor: 'rgba(0, 184, 148, 0.4)'
            },
            {
                name: 'üåü Golden Hour',
                bgType: 'gradient',
                bgColors: ['#f2994a', '#f2c94c', '#ffa726', '#ffb74d'],
                patternType: 'diamonds',
                fontFamily: 'Righteous',
                primaryColor: '#ffffff',
                secondaryColor: '#fff8e1',
                accentColor: '#f39c12',
                shadowColor: 'rgba(243, 156, 18, 0.4)'
            },
            {
                name: 'üç¨ Candy Pop',
                bgType: 'gradient',
                bgColors: ['#f78fb3', '#fad0c4', '#ff9a9e', '#fecfef'],
                patternType: 'bubbles',
                fontFamily: 'Poppins',
                primaryColor: '#ffffff',
                secondaryColor: '#fff0f5',
                accentColor: '#e55982',
                shadowColor: 'rgba(229, 89, 130, 0.4)'
            },
            {
                name: 'üåå Cosmic Night',
                bgType: 'gradient',
                bgColors: ['#141e30', '#243b55', '#2c3e50', '#34495e'],
                patternType: 'stars',
                fontFamily: 'Montserrat',
                primaryColor: '#ffffff',
                secondaryColor: '#ecf0f1',
                accentColor: '#3498db',
                shadowColor: 'rgba(52, 152, 219, 0.4)'
            },
            {
                name: 'üåà Rainbow Joy',
                bgType: 'gradient',
                bgColors: ['#ff0844', '#ffb199', '#ff9068', '#fd3a84'],
                patternType: 'waves',
                fontFamily: 'Poppins',
                primaryColor: '#ffffff',
                secondaryColor: '#fff5f8',
                accentColor: '#fd3a84',
                shadowColor: 'rgba(253, 58, 132, 0.4)'
            }
        ];

        let currentTheme = themes[0];
        let uploadedFiles = [];
        let simboloEmpresa = null;
        let pessoas = [];
        let pessoasFotos = {}; // Armazena as fotos de cada pessoa

        // Criar bot√µes de temas
        const themesContainer = document.getElementById('themesContainer');
        themes.forEach((theme, index) => {
            const btn = document.createElement('div');
            btn.className = 'theme-btn' + (index === 0 ? ' active' : '');
            btn.textContent = theme.name;
            btn.style.background = `linear-gradient(135deg, ${theme.bgColors[0]}, ${theme.bgColors[1]}, ${theme.bgColors[2]})`;
            btn.onclick = () => selectTheme(theme, btn);
            themesContainer.appendChild(btn);
        });

        function selectTheme(theme, btn) {
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentTheme = theme;
            updateAllPreviews();
        }

        // Carregar s√≠mbolo da empresa
        document.getElementById('simboloEmpresa').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        simboloEmpresa = img;
                        updateAllPreviews();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Carregar pasta de fotos
        document.getElementById('pastaFotos').addEventListener('change', function(e) {
            uploadedFiles = Array.from(e.target.files);
            loadAllPhotos();
        });

        // Event listeners para campos de pessoas
        document.querySelectorAll('.pessoaNome, .pessoaEquipe, .pessoaPrefixo').forEach(input => {
            input.addEventListener('input', updateAllPreviews);
        });

        // Event listeners para campos gerais
        document.getElementById('nomeDesafio').addEventListener('input', updateAllPreviews);
        document.getElementById('mensagemParabens').addEventListener('input', updateAllPreviews);

        function loadAllPhotos() {
            pessoasFotos = {};
            
            document.querySelectorAll('.pessoaPrefixo').forEach(input => {
                const index = input.dataset.index;
                const prefix = input.value.trim();
                
                if (prefix && uploadedFiles.length > 0) {
                    loadPhotoForPerson(prefix, index);
                }
            });
        }

        function loadPhotoForPerson(prefix, personIndex) {
            const possibleNames = [
                `${prefix}.jpg`,
                `${prefix}.jpeg`,
                `${prefix}.png`,
                `${prefix}.JPG`,
                `${prefix}.JPEG`,
                `${prefix}.PNG`
            ];

            const photoFile = uploadedFiles.find(file => 
                possibleNames.includes(file.name)
            );

            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        pessoasFotos[personIndex] = img;
                        updateAllPreviews();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(photoFile);
            } else {
                pessoasFotos[personIndex] = null;
                updateAllPreviews();
            }
        }

        function getPessoas() {
            const pessoas = [];
            
            for (let i = 0; i < 59; i++) {
                const nomeInput = document.querySelector(`.pessoaNome[data-index="${i}"]`);
                const equipeInput = document.querySelector(`.pessoaEquipe[data-index="${i}"]`);
                const prefixoInput = document.querySelector(`.pessoaPrefixo[data-index="${i}"]`);
                
                if (nomeInput && equipeInput && prefixoInput) {
                    const nome = nomeInput.value.trim();
                    const equipe = equipeInput.value.trim();
                    const prefixo = prefixoInput.value.trim();
                    
                    if (nome) { // S√≥ adiciona se tiver nome
                        pessoas.push({
                            nome,
                            equipe: equipe || 'Equipe',
                            prefixo,
                            foto: pessoasFotos[i] || null
                        });
                    }
                }
            }
            
            return pessoas;
        }

        function updateAllPreviews() {
            const pessoas = getPessoas();
            const grid = document.getElementById('cardsGrid');
            grid.innerHTML = '';

            if (pessoas.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1/-1;">Preencha pelo menos um nome para ver o preview</p>';
                return;
            }

            pessoas.forEach((pessoa, index) => {
                const container = document.createElement('div');
                container.className = 'card-preview-item';
                
                const canvas = document.createElement('canvas');
                canvas.width = 700;
                canvas.height = 1000;
                canvas.id = `canvas-${index}`;
                
                const label = document.createElement('p');
                label.textContent = pessoa.nome;
                
                const downloadBtn = document.createElement('button');
                downloadBtn.className = 'card-download-btn';
                downloadBtn.textContent = 'üíæ Baixar Card';
                downloadBtn.onclick = () => downloadIndividualCard(index, pessoa.nome);
                
                container.appendChild(canvas);
                container.appendChild(label);
                container.appendChild(downloadBtn);
                grid.appendChild(container);
                
                // Aguardar um pouco para garantir que o canvas foi adicionado ao DOM
                setTimeout(() => {
                    drawCard(canvas, pessoa);
                }, 10);
            });
        }

        function drawCard(canvas, pessoa) {
            const ctx = canvas.getContext('2d');

            // Limpar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Desenhar fundo com gradiente
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, currentTheme.bgColors[0]);
            gradient.addColorStop(0.33, currentTheme.bgColors[1]);
            gradient.addColorStop(0.66, currentTheme.bgColors[2]);
            gradient.addColorStop(1, currentTheme.bgColors[3] || currentTheme.bgColors[1]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Adicionar padr√£o decorativo baseado no tema
            drawPattern(ctx, currentTheme.patternType);

            // S√≠mbolo da Super Barreiras no canto superior esquerdo
            if (simboloEmpresa) {
                const logoSize = 120;
                const logoX = 50;
                const logoY = 50;
                
                ctx.save();
                ctx.shadowColor = currentTheme.shadowColor;
                ctx.shadowBlur = 20;
                ctx.shadowOffsetY = 5;
                
                const aspectRatio = simboloEmpresa.width / simboloEmpresa.height;
                let drawWidth = logoSize;
                let drawHeight = logoSize;
                
                if (aspectRatio > 1) {
                    drawHeight = logoSize / aspectRatio;
                } else {
                    drawWidth = logoSize * aspectRatio;
                }
                
                ctx.drawImage(
                    simboloEmpresa,
                    logoX,
                    logoY,
                    drawWidth,
                    drawHeight
                );
                ctx.restore();
            }

            // Selo "Desafio Completo" no canto superior direito
            const sealSize = 140;
            const sealX = canvas.width - sealSize / 2 - 40;
            const sealY = sealSize / 2 + 40;

            ctx.save();
            ctx.shadowColor = currentTheme.shadowColor;
            ctx.shadowBlur = 30;
            ctx.shadowOffsetY = 10;

            ctx.fillStyle = currentTheme.primaryColor;
            ctx.beginPath();
            ctx.arc(sealX, sealY, sealSize / 2, 0, Math.PI * 2);
            ctx.fill();

            ctx.shadowBlur = 0;
            ctx.shadowOffsetY = 0;

            ctx.fillStyle = currentTheme.accentColor;
            ctx.beginPath();
            ctx.arc(sealX, sealY, sealSize / 2 - 10, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = currentTheme.primaryColor;
            ctx.beginPath();
            ctx.arc(sealX, sealY, sealSize / 2 - 20, 0, Math.PI * 2);
            ctx.fill();

            ctx.font = 'bold 45px Arial';
            ctx.fillStyle = currentTheme.accentColor;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('‚úì', sealX, sealY - 12);

            ctx.font = `700 16px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.accentColor;
            ctx.fillText('DESAFIO', sealX, sealY + 18);
            ctx.fillText('COMPLETO', sealX, sealY + 36);

            ctx.restore();

            // Foto da pessoa (CENTRALIZADA)
            const photoSize = 350;
            const photoY = canvas.height / 2;

            if (pessoa.foto) {
                ctx.save();
                
                ctx.shadowColor = currentTheme.shadowColor;
                ctx.shadowBlur = 40;
                ctx.shadowOffsetY = 15;
                
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.arc(canvas.width / 2, photoY, photoSize / 2 + 12, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.shadowBlur = 0;
                ctx.shadowOffsetY = 0;

                ctx.beginPath();
                ctx.arc(canvas.width / 2, photoY, photoSize / 2, 0, Math.PI * 2);
                ctx.closePath();
                ctx.clip();

                const scale = Math.max(photoSize / pessoa.foto.width, photoSize / pessoa.foto.height);
                const scaledWidth = pessoa.foto.width * scale;
                const scaledHeight = pessoa.foto.height * scale;
                
                ctx.drawImage(
                    pessoa.foto,
                    canvas.width / 2 - scaledWidth / 2,
                    photoY - scaledHeight / 2,
                    scaledWidth,
                    scaledHeight
                );
                ctx.restore();

                ctx.strokeStyle = currentTheme.accentColor;
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.arc(canvas.width / 2, photoY, photoSize / 2, 0, Math.PI * 2);
                ctx.stroke();
            } else {
                ctx.save();
                ctx.shadowColor = currentTheme.shadowColor;
                ctx.shadowBlur = 40;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.beginPath();
                ctx.arc(canvas.width / 2, photoY, photoSize / 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();

                ctx.font = 'bold 100px Arial';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('üì∑', canvas.width / 2, photoY);
            }

            // Nome da pessoa
            ctx.font = `900 58px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.primaryColor;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetY = 5;
            ctx.fillText(pessoa.nome, canvas.width / 2, photoY + photoSize / 2 + 80);

            // Linha decorativa
            ctx.shadowBlur = 10;
            ctx.strokeStyle = currentTheme.secondaryColor;
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            drawWavyLine(ctx, canvas.width / 2 - 150, photoY + photoSize / 2 + 120, canvas.width / 2 + 150, photoY + photoSize / 2 + 120);

            // Nome do Desafio
            ctx.shadowBlur = 15;
            ctx.font = `700 42px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.secondaryColor;
            const nomeDesafio = document.getElementById('nomeDesafio').value || 'Nome do Desafio';
            ctx.fillText(nomeDesafio, canvas.width / 2, photoY + photoSize / 2 + 180);

            // Nome da Equipe
            ctx.font = `600 36px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.primaryColor;
            ctx.fillText(pessoa.equipe, canvas.width / 2, photoY + photoSize / 2 + 230);

            ctx.shadowBlur = 0;
            ctx.shadowOffsetY = 0;

            // Mensagem de parab√©ns
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 15;
            ctx.font = `700 38px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.primaryColor;
            const mensagem = document.getElementById('mensagemParabens').value || 'üéâ PARAB√âNS! üéâ';
            ctx.fillText(mensagem, canvas.width / 2, 80);
        }

        function drawPattern(ctx, type) {
            ctx.globalAlpha = 0.08;
            ctx.fillStyle = '#ffffff';

            switch(type) {
                case 'waves':
                    for (let i = 0; i < 8; i++) {
                        ctx.beginPath();
                        for (let x = 0; x <= ctx.canvas.width; x += 20) {
                            const y = Math.sin((x + i * 100) * 0.01) * 30 + i * 130;
                            if (x === 0) ctx.moveTo(x, y);
                            else ctx.lineTo(x, y);
                        }
                        ctx.stroke();
                    }
                    break;
                case 'dots':
                    for (let i = 0; i < 100; i++) {
                        ctx.beginPath();
                        ctx.arc(
                            Math.random() * ctx.canvas.width,
                            Math.random() * ctx.canvas.height,
                            Math.random() * 5 + 2,
                            0, Math.PI * 2
                        );
                        ctx.fill();
                    }
                    break;
                case 'hexagons':
                case 'stars':
                    for (let i = 0; i < 30; i++) {
                        const x = Math.random() * ctx.canvas.width;
                        const y = Math.random() * ctx.canvas.height;
                        const size = Math.random() * 20 + 10;
                        drawStar(ctx, x, y, 5, size, size / 2);
                    }
                    break;
                case 'circles':
                    for (let i = 0; i < 40; i++) {
                        ctx.beginPath();
                        ctx.arc(
                            Math.random() * ctx.canvas.width,
                            Math.random() * ctx.canvas.height,
                            Math.random() * 40 + 20,
                            0, Math.PI * 2
                        );
                        ctx.stroke();
                    }
                    break;
                case 'triangles':
                case 'diamonds':
                    for (let i = 0; i < 30; i++) {
                        const x = Math.random() * ctx.canvas.width;
                        const y = Math.random() * ctx.canvas.height;
                        const size = Math.random() * 30 + 20;
                        ctx.beginPath();
                        ctx.moveTo(x, y - size);
                        ctx.lineTo(x + size, y + size);
                        ctx.lineTo(x - size, y + size);
                        ctx.closePath();
                        ctx.fill();
                    }
                    break;
                case 'bubbles':
                    for (let i = 0; i < 50; i++) {
                        ctx.beginPath();
                        ctx.arc(
                            Math.random() * ctx.canvas.width,
                            Math.random() * ctx.canvas.height,
                            Math.random() * 30 + 10,
                            0, Math.PI * 2
                        );
                        ctx.fill();
                    }
                    break;
            }
            ctx.globalAlpha = 1;
        }

        function drawStar(ctx, cx, cy, spikes, outerRadius, innerRadius) {
            let rot = Math.PI / 2 * 3;
            let x = cx;
            let y = cy;
            const step = Math.PI / spikes;

            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);
            for (let i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;

                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
            ctx.fill();
        }

        function drawWavyLine(ctx, x1, y1, x2, y2) {
            const segments = 20;
            const amplitude = 5;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            for (let i = 0; i <= segments; i++) {
                const x = x1 + (x2 - x1) * (i / segments);
                const y = y1 + Math.sin(i * 0.5) * amplitude;
                ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        function exportCard() {
            const canvas = document.getElementById('cardCanvas');
            const nomeColega = document.getElementById('nomeColega').value || 'card';
            const fileName = `card_${nomeColega.replace(/\s+/g, '_')}_${Date.now()}.png`;
            
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 'image/png', 1.0);
        }

        function exportAllCards() {
            const pessoas = getPessoas();
            
            if (pessoas.length === 0) {
                alert('Adicione pelo menos uma pessoa para gerar os cards!');
                return;
            }

            pessoas.forEach((pessoa, index) => {
                setTimeout(() => {
                    downloadIndividualCard(index, pessoa.nome);
                }, index * 300); // Delay entre downloads
            });
        }

        function downloadIndividualCard(index, nomePessoa) {
            const canvas = document.getElementById(`canvas-${index}`);
            
            if (!canvas) {
                console.error('Canvas n√£o encontrado:', index);
                return;
            }
            
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `card_${nomePessoa.replace(/\s+/g, '_')}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 'image/png', 1.0);
        }

        function processarTabela() {
            const texto = document.getElementById('tabelaDados').value.trim();
            
            if (!texto) {
                alert('Cole os dados da tabela primeiro!');
                return;
            }

            // Dividir em linhas
            const linhas = texto.split('\n').filter(linha => linha.trim());
            
            linhas.forEach((linha, index) => {
                if (index >= 59) return; // M√°ximo 59 pessoas
                
                // Tentar separar por tab ou v√≠rgula
                let partes = linha.split('\t');
                if (partes.length < 3) {
                    partes = linha.split(',');
                }
                
                if (partes.length >= 3) {
                    const prefixo = partes[0].trim();
                    const dependencia = partes[1].trim();
                    const nomeCompleto = partes[2].trim();
                    
                    // Extrair primeiro nome
                    const primeiroNome = nomeCompleto.split(' ')[0];
                    
                    // Preencher os campos
                    const inputNome = document.querySelector(`.pessoaNome[data-index="${index}"]`);
                    const inputEquipe = document.querySelector(`.pessoaEquipe[data-index="${index}"]`);
                    const inputPrefixo = document.querySelector(`.pessoaPrefixo[data-index="${index}"]`);
                    
                    if (inputNome && inputEquipe && inputPrefixo) {
                        inputNome.value = primeiroNome;
                        inputEquipe.value = dependencia;
                        inputPrefixo.value = prefixo;
                        
                        // Carregar foto correspondente
                        if (uploadedFiles.length > 0) {
                            loadPhotoForPerson(prefixo, index);
                        }
                    }
                }
            });
            
            // Atualizar previews ap√≥s um pequeno delay para garantir que as fotos foram carregadas
            setTimeout(() => {
                updateAllPreviews();
            }, 500);
            
            alert(`‚úÖ ${Math.min(linhas.length, 59)} pessoa(s) importada(s) com sucesso!`);
        }

        function gerarGaleria(colunas) {
            const pessoas = getPessoas();
            
            if (pessoas.length === 0) {
                alert('Adicione pelo menos uma pessoa para gerar a galeria!');
                return;
            }

            const galeriaCanvas = document.getElementById('galeriaCanvas');
            const cardWidth = 350; // Reduzido para caber melhor
            const cardHeight = 500; // Reduzido proporcionalmente
            const spacing = 20; // Espa√ßamento entre cards
            const margin = 60; // Margem externa
            const tituloHeight = 150; // Espa√ßo para t√≠tulo
            const rodapeHeight = 100; // Espa√ßo para rodap√©
            
            const linhas = Math.ceil(pessoas.length / colunas);
            
            // Calcular dimens√µes da galeria
            galeriaCanvas.width = (cardWidth * colunas) + (spacing * (colunas - 1)) + (margin * 2);
            galeriaCanvas.height = tituloHeight + (cardHeight * linhas) + (spacing * (linhas - 1)) + margin + rodapeHeight;
            
            const ctx = galeriaCanvas.getContext('2d');
            
            // Fundo da galeria com gradiente DO TEMA SELECIONADO
            const gradient = ctx.createLinearGradient(0, 0, galeriaCanvas.width, galeriaCanvas.height);
            gradient.addColorStop(0, currentTheme.bgColors[0]);
            gradient.addColorStop(0.33, currentTheme.bgColors[1]);
            gradient.addColorStop(0.66, currentTheme.bgColors[2]);
            gradient.addColorStop(1, currentTheme.bgColors[3] || currentTheme.bgColors[1]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, galeriaCanvas.width, galeriaCanvas.height);
            
            // Adicionar padr√£o decorativo do tema
            ctx.save();
            ctx.globalAlpha = 0.06;
            drawPattern(ctx, currentTheme.patternType);
            ctx.globalAlpha = 1;
            ctx.restore();
            
            // T√≠tulo da galeria com fonte e cor do tema
            ctx.font = `bold 60px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.primaryColor;
            ctx.textAlign = 'center';
            ctx.shadowColor = currentTheme.shadowColor;
            ctx.shadowBlur = 30;
            ctx.shadowOffsetY = 10;
            ctx.fillText('üèÜ SUPER BARREIRAS üèÜ', galeriaCanvas.width / 2, 70);
            
            ctx.font = `bold 40px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.secondaryColor;
            ctx.fillText('CAMPE√ïES', galeriaCanvas.width / 2, 120);
            ctx.shadowBlur = 0;
            ctx.shadowOffsetY = 0;
            
            // Desenhar cada card na galeria
            pessoas.forEach((pessoa, index) => {
                const col = index % colunas;
                const row = Math.floor(index / colunas);
                
                const x = margin + (col * (cardWidth + spacing));
                const y = tituloHeight + (row * (cardHeight + spacing));
                
                // Pegar canvas individual
                const sourceCanvas = document.getElementById(`canvas-${index}`);
                if (sourceCanvas) {
                    // Sombra do card com cor do tema
                    ctx.shadowColor = currentTheme.shadowColor;
                    ctx.shadowBlur = 30;
                    ctx.shadowOffsetX = 5;
                    ctx.shadowOffsetY = 15;
                    
                    // Moldura colorida ao redor de cada card
                    ctx.strokeStyle = currentTheme.accentColor;
                    ctx.lineWidth = 4;
                    ctx.strokeRect(x - 2, y - 2, cardWidth + 4, cardHeight + 4);
                    
                    // Desenhar card redimensionado
                    ctx.drawImage(sourceCanvas, x, y, cardWidth, cardHeight);
                    
                    ctx.shadowBlur = 0;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                }
            });
            
            // Rodap√© com cores do tema
            const nomeDesafio = document.getElementById('nomeDesafio').value || 'Desafio';
            ctx.font = `bold 40px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.primaryColor;
            ctx.textAlign = 'center';
            ctx.shadowColor = currentTheme.shadowColor;
            ctx.shadowBlur = 20;
            ctx.shadowOffsetY = 5;
            ctx.fillText(nomeDesafio, galeriaCanvas.width / 2, galeriaCanvas.height - 40);
            
            // Linha decorativa no rodap√©
            ctx.strokeStyle = currentTheme.secondaryColor;
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            drawWavyLine(ctx, galeriaCanvas.width / 2 - 200, galeriaCanvas.height - 70, galeriaCanvas.width / 2 + 200, galeriaCanvas.height - 70);
            
            // Scroll para a galeria
            galeriaCanvas.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function limparCampos() {
            if (!confirm('‚ö†Ô∏è Deseja realmente limpar todos os campos de pessoas? Esta a√ß√£o n√£o pode ser desfeita.')) {
                return;
            }

            // Limpar todos os campos de pessoas (agora s√£o 59)
            for (let i = 0; i < 59; i++) {
                const inputNome = document.querySelector(`.pessoaNome[data-index="${i}"]`);
                const inputEquipe = document.querySelector(`.pessoaEquipe[data-index="${i}"]`);
                const inputPrefixo = document.querySelector(`.pessoaPrefixo[data-index="${i}"]`);
                
                if (inputNome) inputNome.value = '';
                if (inputEquipe) inputEquipe.value = '';
                if (inputPrefixo) inputPrefixo.value = '';
            }

            // Limpar tamb√©m a √°rea de tabela
            document.getElementById('tabelaDados').value = '';

            // Limpar fotos carregadas das pessoas
            pessoasFotos = {};

            // Atualizar previews
            updateAllPreviews();

            alert('‚úÖ Todos os campos foram limpos com sucesso!');
        }

        function atualizarPreviews() {
            // Recarregar todas as fotos baseado nos prefixos atuais (59 pessoas)
            for (let i = 0; i < 59; i++) {
                const inputPrefixo = document.querySelector(`.pessoaPrefixo[data-index="${i}"]`);
                const prefix = inputPrefixo ? inputPrefixo.value.trim() : '';
                
                if (prefix && uploadedFiles.length > 0) {
                    loadPhotoForPerson(prefix, i);
                }
            }

            // Atualizar todos os previews
            setTimeout(() => {
                updateAllPreviews();
                alert('‚úÖ Previews atualizados com sucesso!');
            }, 500);
        }

        function processarTabela() {
            const texto = document.getElementById('tabelaDados').value.trim();
            
            if (!texto) {
                alert('Cole os dados da tabela primeiro!');
                return;
            }

            // Dividir em linhas
            const linhas = texto.split('\n').filter(linha => linha.trim());
            
            linhas.forEach((linha, index) => {
                if (index >= 59) return; // M√°ximo 59 pessoas agora
                
                // Tentar separar por tab ou v√≠rgula
                let partes = linha.split('\t');
                if (partes.length < 3) {
                    partes = linha.split(',');
                }
                
                if (partes.length >= 3) {
                    const prefixo = partes[0].trim();
                    const dependencia = partes[1].trim();
                    const nomeCompleto = partes[2].trim();
                    
                    // Extrair primeiro nome
                    const primeiroNome = nomeCompleto.split(' ')[0];
                    
                    // Preencher os campos
                    const inputNome = document.querySelector(`.pessoaNome[data-index="${index}"]`);
                    const inputEquipe = document.querySelector(`.pessoaEquipe[data-index="${index}"]`);
                    const inputPrefixo = document.querySelector(`.pessoaPrefixo[data-index="${index}"]`);
                    
                    if (inputNome && inputEquipe && inputPrefixo) {
                        inputNome.value = primeiroNome;
                        inputEquipe.value = dependencia;
                        inputPrefixo.value = prefixo;
                        
                        // Carregar foto correspondente
                        if (uploadedFiles.length > 0) {
                            loadPhotoForPerson(prefixo, index);
                        }
                    }
                }
            });
            
            // Atualizar previews ap√≥s um pequeno delay para garantir que as fotos foram carregadas
            setTimeout(() => {
                updateAllPreviews();
            }, 500);
            
            alert(`‚úÖ ${Math.min(linhas.length, 59)} pessoa(s) importada(s) com sucesso!`);
        }

        function gerarTodasGalerias(colunas) {
            const pessoas = getPessoas();
            
            if (pessoas.length === 0) {
                alert('Adicione pelo menos uma pessoa para gerar as galerias!');
                return;
            }

            const galeriasContainer = document.getElementById('galeriasContainer');
            galeriasContainer.innerHTML = '';

            // Dividir pessoas em grupos de 10
            const grupos = [];
            for (let i = 0; i < pessoas.length; i += 10) {
                grupos.push(pessoas.slice(i, i + 10));
            }

            // Gerar uma galeria para cada grupo
            grupos.forEach((grupo, grupoIndex) => {
                const galeriaItem = document.createElement('div');
                galeriaItem.className = 'galeria-item';
                
                const titulo = document.createElement('h3');
                titulo.textContent = `üèÜ Galeria ${grupoIndex + 1} - Campe√µes ${grupoIndex * 10 + 1} a ${grupoIndex * 10 + grupo.length}`;
                
                const canvas = document.createElement('canvas');
                canvas.id = `galeria-${grupoIndex}`;
                
                const downloadBtn = document.createElement('button');
                downloadBtn.className = 'galeria-download-btn';
                downloadBtn.textContent = `üíæ Baixar Galeria ${grupoIndex + 1}`;
                downloadBtn.onclick = () => exportarGaleriaIndividual(grupoIndex);
                
                galeriaItem.appendChild(titulo);
                galeriaItem.appendChild(canvas);
                galeriaItem.appendChild(downloadBtn);
                galeriasContainer.appendChild(galeriaItem);
                
                // Gerar a galeria
                gerarGaleriaGrupo(canvas, grupo, colunas, grupoIndex);
            });

            // Scroll para as galerias
            galeriasContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function gerarGaleriaGrupo(canvas, grupo, colunas, grupoIndex) {
            const cardWidth = 350;
            const cardHeight = 500;
            const spacing = 20;
            const margin = 60;
            const tituloHeight = 150;
            const rodapeHeight = 100;
            
            const linhas = Math.ceil(grupo.length / colunas);
            
            // Calcular dimens√µes da galeria
            canvas.width = (cardWidth * colunas) + (spacing * (colunas - 1)) + (margin * 2);
            canvas.height = tituloHeight + (cardHeight * linhas) + (spacing * (linhas - 1)) + margin + rodapeHeight;
            
            const ctx = canvas.getContext('2d');
            
            // Fundo da galeria com gradiente DO TEMA SELECIONADO
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, currentTheme.bgColors[0]);
            gradient.addColorStop(0.33, currentTheme.bgColors[1]);
            gradient.addColorStop(0.66, currentTheme.bgColors[2]);
            gradient.addColorStop(1, currentTheme.bgColors[3] || currentTheme.bgColors[1]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Adicionar padr√£o decorativo do tema
            ctx.save();
            ctx.globalAlpha = 0.06;
            drawPattern(ctx, currentTheme.patternType);
            ctx.globalAlpha = 1;
            ctx.restore();
            
            // T√≠tulo da galeria com fonte e cor do tema
            ctx.font = `bold 60px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.primaryColor;
            ctx.textAlign = 'center';
            ctx.shadowColor = currentTheme.shadowColor;
            ctx.shadowBlur = 30;
            ctx.shadowOffsetY = 10;
            ctx.fillText('üèÜ SUPER BARREIRAS üèÜ', canvas.width / 2, 70);
            
            ctx.font = `bold 40px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.secondaryColor;
            ctx.fillText('CAMPE√ïES', canvas.width / 2, 120);
            ctx.shadowBlur = 0;
            ctx.shadowOffsetY = 0;
            
            // Desenhar cada card na galeria
            grupo.forEach((pessoa, index) => {
                const col = index % colunas;
                const row = Math.floor(index / colunas);
                
                const x = margin + (col * (cardWidth + spacing));
                const y = tituloHeight + (row * (cardHeight + spacing));
                
                // Calcular √≠ndice global da pessoa
                const globalIndex = grupoIndex * 10 + index;
                
                // Pegar canvas individual
                const sourceCanvas = document.getElementById(`canvas-${globalIndex}`);
                if (sourceCanvas) {
                    // Sombra do card com cor do tema
                    ctx.shadowColor = currentTheme.shadowColor;
                    ctx.shadowBlur = 30;
                    ctx.shadowOffsetX = 5;
                    ctx.shadowOffsetY = 15;
                    
                    // Moldura colorida ao redor de cada card
                    ctx.strokeStyle = currentTheme.accentColor;
                    ctx.lineWidth = 4;
                    ctx.strokeRect(x - 2, y - 2, cardWidth + 4, cardHeight + 4);
                    
                    // Desenhar card redimensionado
                    ctx.drawImage(sourceCanvas, x, y, cardWidth, cardHeight);
                    
                    ctx.shadowBlur = 0;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;
                }
            });
            
            // Rodap√© com cores do tema
            const nomeDesafio = document.getElementById('nomeDesafio').value || 'Desafio';
            ctx.font = `bold 40px ${currentTheme.fontFamily}`;
            ctx.fillStyle = currentTheme.primaryColor;
            ctx.textAlign = 'center';
            ctx.shadowColor = currentTheme.shadowColor;
            ctx.shadowBlur = 20;
            ctx.shadowOffsetY = 5;
            ctx.fillText(nomeDesafio, canvas.width / 2, canvas.height - 40);
            
            // Linha decorativa no rodap√©
            ctx.strokeStyle = currentTheme.secondaryColor;
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            drawWavyLine(ctx, canvas.width / 2 - 200, canvas.height - 70, canvas.width / 2 + 200, canvas.height - 70);
        }

        function exportarGaleriaIndividual(grupoIndex) {
            const canvas = document.getElementById(`galeria-${grupoIndex}`);
            
            if (!canvas || !canvas.width) {
                alert('Gere as galerias primeiro!');
                return;
            }
            
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `galeria_super_barreiras_${grupoIndex + 1}_${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 'image/png', 1.0);
        }

        // Event listeners para campos de pessoas (agora com gera√ß√£o din√¢mica)
        document.addEventListener('DOMContentLoaded', function() {
            // Aguardar gera√ß√£o dos campos
            setTimeout(() => {
                document.querySelectorAll('.pessoaNome, .pessoaEquipe, .pessoaPrefixo').forEach(input => {
                    input.addEventListener('input', updateAllPreviews);
                });
            }, 100);
        });

        // Desenhar previews iniciais
        setTimeout(() => {
            updateAllPreviews();
        }, 200);
    </script>
</body>
</html>